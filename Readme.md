# Yueling Telegram Bot æ¡†æ¶

ä¸€ä¸ªåŸºäº Go çš„ Telegram èŠå¤©æœºå™¨äººæ¡†æ¶ï¼Œæ”¯æŒæ’ä»¶åŒ–å¼€å‘ã€å‘½ä»¤åŒ¹é…å™¨ã€æƒé™æ§åˆ¶ã€æ¡ä»¶è§„åˆ™ä»¥åŠæ¶ˆæ¯/å›è°ƒäº‹ä»¶å¤„ç†ã€‚æ¡†æ¶å†…ç½®å¤šç§ç¤ºä¾‹æ’ä»¶ï¼ŒåŒ…æ‹¬éšæœºå›¾ç‰‡ã€è¡¨æƒ…åŒ…ã€éª°å­å’Œç‚¹æ­ŒåŠŸèƒ½ã€‚

---

## ğŸš€ ç‰¹æ€§

* **æ’ä»¶åŒ–æ¶æ„**ï¼šæ”¯æŒ DSL é£æ ¼æ³¨å†Œæ’ä»¶å’Œå‘½ä»¤ã€‚
* **ä¸­é—´ä»¶é“¾**ï¼šæ”¯æŒè‡ªå®šä¹‰ä¸­é—´ä»¶å¤„ç†æ¶ˆæ¯ã€‚
* **è§„åˆ™/æ¡ä»¶ç³»ç»Ÿ**ï¼šå¯çµæ´»ç»„åˆæ¡ä»¶ï¼ˆAll / Any / Notï¼‰ã€‚
* **æƒé™ç³»ç»Ÿ**ï¼šæ’ä»¶å¯å®šä¹‰æƒé™è§„åˆ™ã€‚
* **æ¶ˆæ¯ç±»å‹æ”¯æŒ**ï¼šæ–‡æœ¬æ¶ˆæ¯ã€å›è°ƒæŒ‰é’®ã€é€šçŸ¥ã€åª’ä½“æ¶ˆæ¯ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
yueling_tg/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ core/              // æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ context/       // ä¸Šä¸‹æ–‡ä¸æ¶ˆæ¯å°è£…
â”‚   â”‚   â”œâ”€â”€ log/           // æ—¥å¿—æ¨¡å—
â”‚   â”‚   â””â”€â”€ plugin/        // å†…éƒ¨æ’ä»¶ç›¸å…³é€»è¾‘
â”‚   â”œâ”€â”€ message/           // æ¶ˆæ¯å¤„ç†å·¥å…·ï¼ˆå›¾ç‰‡ã€æ–‡æœ¬ç­‰ï¼‰
â”‚   â””â”€â”€ middleware/        // ä¸­é—´ä»¶é“¾
â””â”€â”€ pkg/
    â”œâ”€â”€ bot/               // Bot æ ¸å¿ƒé€»è¾‘
    â”œâ”€â”€ common/            // å…¬å…±å·¥å…·å‡½æ•°
    â””â”€â”€ plugin/            // æ’ä»¶ç³»ç»Ÿ
        â”œâ”€â”€ dsl/           // DSL æ„å»ºå™¨
        â”‚   â”œâ”€â”€ condition/ // æ¡ä»¶è§„åˆ™
        â”‚   â”œâ”€â”€ permission/ // æƒé™æ¨¡å—
        â”‚   â””â”€â”€ rule/       // è§„åˆ™å°è£…
        â”œâ”€â”€ handler/       // å¤„ç†å™¨å°è£…
        â”œâ”€â”€ params/        // å‚æ•°è§£æ
        â””â”€â”€ provider/      // æ•°æ®/ä¸Šä¸‹æ–‡æä¾›è€…
â””â”€â”€ main.go                 // å¯åŠ¨å…¥å£
```

---

## âš™ï¸ å®‰è£…ä¸è¿è¡Œ

```
# å…‹éš†é¡¹ç›®
git clone https://github.com/yuelioiyueling_tg.git
cd yueling_tg
# ä¸‹è½½ä¾èµ–
go mod tidy
# è¿è¡Œ Bot
go run main.go
```

> éœ€åœ¨ `.env` ä¸­è®¾ç½® Telegram Bot Tokenã€‚

---

## ğŸ”Œ æ’ä»¶å¼€å‘æŒ‡å—

æ¡†æ¶é‡‡ç”¨ **Builder DSL**ï¼Œæ’ä»¶å¼€å‘æµç¨‹ï¼š

1. **åˆ›å»ºæ’ä»¶ç»“æ„ä½“**

```
type MyPlugin struct {
    *plugin.Base
}
```

1. **å®ç°æ’ä»¶å…¥å£**

```
func NewMyPlugin() plugin.Plugin {
    mp := &MyPlugin{
        Base: plugin.NewBase(&plugin.PluginInfo{
            ID:          "myplugin",
            Name:        "ç¤ºä¾‹æ’ä»¶",
            Description: "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶",
            Version:     "0.1.0",
            Author:      "æœˆç¦»",
            Group:       "demo",
        }),
    }
    builder := plugin.New().
        Info(mp.PluginInfo())
    // æ³¨å†Œæ¶ˆæ¯åŒ¹é…å™¨
    builder.OnMessage().Do(mp.handleMessage)
    // æ³¨å†Œå‘½ä»¤åŒ¹é…å™¨
    builder.OnCommand("ç¤ºä¾‹").Do(mp.handleCommand)
    return builder.Go()
}
```

1. **å¤„ç†æ¶ˆæ¯ / å‘½ä»¤**

```
func (mp *MyPlugin) handleMessage(c *context.Context) {
    c.Reply("æ”¶åˆ°æ¶ˆæ¯å•¦!")
}
func (mp *MyPlugin) handleCommand(c *context.Context) {
    c.Reply("å‘½ä»¤å·²è§¦å‘!")
}
```

1. **å†æ¥ä¸€å¼  / å†æ¥ä¸€é¦–**

* ä½¿ç”¨å›è°ƒæŒ‰é’® + `OnCallbackStartsWith`
* ä¿®æ”¹åŸæ¶ˆæ¯å®ç°æŒ‰é’®åŠŸèƒ½

---

## ğŸ“¦ ç¤ºä¾‹æ’ä»¶

### éšæœºå›¾ç‰‡æ’ä»¶

* æ”¯æŒå‘é€éšæœºå›¾ç‰‡
* æ”¯æŒå›è°ƒæŒ‰é’® â€œå†æ¥ä¸€å¼ â€

### è¡¨æƒ…åŒ…æ’ä»¶

* æ”¯æŒ `#å…³é”®è¯` éšæœºè¡¨æƒ…åŒ…
* æ”¯æŒæŸ¥è¯¢è¡¨æƒ…åŒ…åˆ—è¡¨ `##å…³é”®è¯`
* æ”¯æŒ â€œå†æ¥ä¸€å¼ â€ å›è°ƒæŒ‰é’®

### éª°å­æ’ä»¶

* æ”¯æŒæŠ•æ· ğŸ² / ğŸ¯ / ğŸ€ / âš½ / ğŸ§­
* å‘½ä»¤ï¼š`éª°å­ [ç±»å‹]`

### ç‚¹æ­Œæ’ä»¶

* å‘½ä»¤ï¼š`ç‚¹æ­Œ <æ­Œæ›²å>`
* å›è°ƒæŒ‰é’®ï¼š`å†æ¥ä¸€é¦–`
* éšæœºæ›´æ¢æ­Œæ›²å¹¶æ›´æ–°åŸæ¶ˆæ¯

## todo

é…ç½®ä¸­å¿ƒ

---

## âš¡ ä½¿ç”¨ Builder æ„å»ºæ’ä»¶

| æ–¹æ³•                                | è¯´æ˜                 |
| :---------------------------------- | :------------------- |
| OnMessage()                         | åŒ¹é…æ‰€æœ‰æ–‡æœ¬æ¶ˆæ¯     |
| OnCommand(cmds ...string)           | åŒ¹é…æŒ‡å®šå‘½ä»¤         |
| OnCallbackStartsWith(prefix string) | åŒ¹é…å›è°ƒäº‹ä»¶         |
| Priority(int)                       | è®¾ç½®åŒ¹é…å™¨ä¼˜å…ˆçº§     |
| Block(bool)                         | æ˜¯å¦é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­ |
| Do(handlerFn)                       | ç»‘å®šå¤„ç†å‡½æ•°         |

---

## ğŸ“ ç¤ºä¾‹ï¼šæ³¨å†Œæ’ä»¶

```

bot.RegisterPlugins(
    NewEmotePlugin(),
    NewDicePlugin(),
    NewMusicPlugin(),
)
bot.Run()
```

---

## ğŸ›  è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. æ–°å¢æ’ä»¶åˆ° `plugins/` ç›®å½•
3. æäº¤ PR å¹¶è¯´æ˜åŠŸèƒ½

---

## ğŸ“„ License

MIT License Â© æœˆç¦»
